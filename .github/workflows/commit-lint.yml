---
name: Validate Commit Messages
on: [push]

jobs:
  commitlint_n:
    name: Check Commit Messages
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
        with:
          # Fetch entire commit history for range checking
          fetch-depth: 0

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Install Commitlint
        run: npm install -g @commitlint/cli

      - name: Create Commitlint Config
        run: |
          cat <<EOF > .commitlintrc.yaml
          rules:
            header-pattern: [2, 'always', '^TAURUS-\\d+: .+$']
            type-enum: [0]
            scope-empty: [0]
            subject-empty: [0]
          EOF

      - name: Validate Commit Messages
        run: |
          # Check all new commits in this push
          commitlint --from ${{ github.event.before }} --to ${{ github.sha }}
